<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests - Albert Heijn Zelfscanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        .test-summary {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #e9ecef;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Albert Heijn Zelfscanner - Automated Tests</h1>
        <div id="test-results"></div>
        <div id="test-summary" class="test-summary"></div>
    </div>

    <script src="products.js"></script>
    <script>
        // Simple test framework
        class TestRunner {
            constructor() {
                this.tests = [];
                this.passed = 0;
                this.failed = 0;
            }

            test(name, fn) {
                this.tests.push({ name, fn });
            }

            async run() {
                const resultsEl = document.getElementById('test-results');
                const summaryEl = document.getElementById('test-summary');

                for (const test of this.tests) {
                    try {
                        await test.fn();
                        this.passed++;
                        resultsEl.innerHTML += `<div class="test-result test-pass">✓ ${test.name}</div>`;
                    } catch (error) {
                        this.failed++;
                        resultsEl.innerHTML += `<div class="test-result test-fail">✗ ${test.name}: ${error.message}</div>`;
                    }
                }

                summaryEl.innerHTML = `
                    <h3>Test Summary</h3>
                    <p>Total: ${this.tests.length} | Passed: ${this.passed} | Failed: ${this.failed}</p>
                    <p>Success Rate: ${((this.passed / this.tests.length) * 100).toFixed(1)}%</p>
                `;
            }

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message || 'Assertion failed');
                }
            }

            assertEqual(actual, expected, message) {
                if (actual !== expected) {
                    throw new Error(message || `Expected ${expected}, got ${actual}`);
                }
            }

            assertNotNull(value, message) {
                if (value === null || value === undefined) {
                    throw new Error(message || 'Value should not be null/undefined');
                }
            }
        }

        // Initialize test runner
        const runner = new TestRunner();

        // Product Database Tests
        runner.test('Products database should be defined', () => {
            runner.assertNotNull(PRODUCTS_DATABASE, 'PRODUCTS_DATABASE should be defined');
        });

        runner.test('Products database should contain products', () => {
            const productCount = Object.keys(PRODUCTS_DATABASE).length;
            runner.assert(productCount > 0, 'Should have at least one product');
        });

        runner.test('All products should have required fields', () => {
            for (const [barcode, product] of Object.entries(PRODUCTS_DATABASE)) {
                runner.assertNotNull(product.name, `Product ${barcode} should have a name`);
                runner.assertNotNull(product.price, `Product ${barcode} should have a price`);
                runner.assertNotNull(product.description, `Product ${barcode} should have a description`);
                runner.assertNotNull(product.category, `Product ${barcode} should have a category`);
                runner.assert(typeof product.price === 'number', `Product ${barcode} price should be a number`);
                runner.assert(product.price > 0, `Product ${barcode} price should be positive`);
            }
        });

        runner.test('findProductByBarcode should work correctly', () => {
            const firstBarcode = Object.keys(PRODUCTS_DATABASE)[0];
            const product = findProductByBarcode(firstBarcode);
            runner.assertNotNull(product, 'Should find product with valid barcode');
            
            const invalidProduct = findProductByBarcode('invalid-barcode');
            runner.assertEqual(invalidProduct, null, 'Should return null for invalid barcode');
        });

        runner.test('getRandomProducts should return valid products', () => {
            const randomProducts = getRandomProducts(5);
            runner.assertEqual(randomProducts.length, 5, 'Should return requested number of products');
            
            randomProducts.forEach((product, index) => {
                runner.assertNotNull(product.name, `Random product ${index} should have a name`);
                runner.assertNotNull(product.price, `Random product ${index} should have a price`);
                runner.assertNotNull(product.quantity, `Random product ${index} should have a quantity`);
                runner.assert(product.quantity >= 1 && product.quantity <= 3, `Random product ${index} quantity should be 1-3`);
            });
        });

        runner.test('searchProductsByName should work correctly', () => {
            const results = searchProductsByName('melk');
            runner.assert(results.length > 0, 'Should find products containing "melk"');
            
            const noResults = searchProductsByName('xyz123nonexistent');
            runner.assertEqual(noResults.length, 0, 'Should return empty array for non-existent search');
        });

        runner.test('getAllCategories should return unique categories', () => {
            const categories = getAllCategories();
            runner.assert(categories.length > 0, 'Should return at least one category');
            
            const uniqueCategories = [...new Set(categories)];
            runner.assertEqual(categories.length, uniqueCategories.length, 'Categories should be unique');
        });

        runner.test('getProductsByCategory should filter correctly', () => {
            const categories = getAllCategories();
            if (categories.length > 0) {
                const firstCategory = categories[0];
                const products = getProductsByCategory(firstCategory);
                runner.assert(products.length > 0, `Should find products in category ${firstCategory}`);
                
                products.forEach(product => {
                    runner.assertEqual(product.category, firstCategory, 'All returned products should be in the requested category');
                });
            }
        });

        // Format Testing
        runner.test('Product prices should be reasonable', () => {
            for (const [barcode, product] of Object.entries(PRODUCTS_DATABASE)) {
                runner.assert(product.price >= 0.01 && product.price <= 100, 
                    `Product ${product.name} price ${product.price} should be reasonable (0.01-100 EUR)`);
            }
        });

        runner.test('Product names should be in Dutch', () => {
            const dutchWords = ['AH', 'melk', 'brood', 'kaas', 'koffie', 'thee'];
            let dutchProductsFound = 0;
            
            for (const [barcode, product] of Object.entries(PRODUCTS_DATABASE)) {
                const hasAH = product.name.includes('AH');
                const hasDutchWord = dutchWords.some(word => 
                    product.name.toLowerCase().includes(word) || 
                    product.description.toLowerCase().includes(word)
                );
                
                if (hasAH || hasDutchWord) {
                    dutchProductsFound++;
                }
            }
            
            runner.assert(dutchProductsFound > 0, 'Should have products with Dutch names/descriptions');
        });

        // Run all tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            runner.run();
        });
    </script>
</body>
</html>